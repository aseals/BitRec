<!DOCTYPE html>
<html lang="en">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Billytics</title>
    <meta name="generator" content="Bootply" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="card/lib/css/card.css">
    <!-- <link href="//netdna.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet"> -->
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link href="css/styles.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
  </head>



  <body>
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
 -->
<script type="text/javascript" src="src/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="src/jquery.qrcode.js"></script>
<script type="text/javascript" src="src/qrcode.js"></script>

<p>The QR Code</p>
<div id="qrcodeTable"></div>

<script>
$(document).ready(function() {
   var addr = '16bM5gBfagBTLJ6HD8Lw4RsbbF61pmRPuB';
    var url = 'https://blockchain.info/api/receive?method=create&address=16bM5gBfagBTLJ6HD8Lw4RsbbF61pmRPuB&callback=';
    $.ajax({
      url: url,

      success: function(data) {
        input_addr = data.input_address;
        //console.log(input_addr);
        qr(input_addr);
        var timemax=0;
        transaction_check(input_addr, timemax) ;
      }
    });

})

function qr(input) {
          $('#qrcodeTable').qrcode({
            render  : "table",
            text  : input
          });
}


function transaction_check(input_addr, timemax) {
    var api_key_id = 'DEMO-4a5e1e4';
    var address = input_addr ;
    var url = 'https://api.chain.com/v2/bitcoin/addresses/' + address + '/transactions';
    timemax = timemax +1;
    $.ajax({
      url: url,
      data: {limit: 2, 'api-key-id': api_key_id},
      type: 'GET',
      success: function(data) {
        // console.log(data)

        if (timemax <= 100){
        if ( data.length == 0 ) {
        console.log("Transaction not done yet");
        setTimeout(transaction_check (input_addr, timemax), 3000);
         }
        else if(data[0].confirmations > 0)
          { console.log('Transaction is confirmed');}
        else { console.log('Transaction not confirmed. Please reload'); 
               setTimeout(transaction_check (input_addr, timemax), 2000);
              }
         }     
      }
    });
  }
   
</script>




  <!-- script references -->
    <script src="js/bootstrap.min.js"></script>
    <script src="js/script.js"></script>
    <script src="js/homepage.js"></script>
    <script src="card/lib/js/card.js"></script>
  </body>
</html>
